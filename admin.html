<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Prijave na radionice</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #loginForm, #dataSection { max-width: 700px; margin: auto; }
    input { display: block; width: 100%; margin: 10px 0; padding: 8px; }
    button { padding: 8px 15px; background: #097f69; color: white; border: none; cursor: pointer; }
    button:hover { background: #05caa7; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    .counters { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
    .counters h3 { margin-top: 0; }
    .counter-list { display: flex; gap: 20px; flex-wrap: wrap; }
    .counter-item { background: #eef; padding: 10px 15px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>üìä Admin panel - Prijave</h1>

  <!-- Login forma -->
  <div id="loginForm">
    <h2>Prijava</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Lozinka">
    <button id="loginBtn">Prijavi se</button>
    <p id="loginStatus"></p>
  </div>

  <!-- Podaci (prikazuje se nakon login-a) -->
  <div id="dataSection" style="display:none;">
    <p><button id="logoutBtn">Odjava</button></p>
    <p id="status">Uƒçitavam podatke...</p>

    <!-- Brojaƒç prijava -->
    <div class="counters" id="counters" style="display:none;">
      <h3>Ukupne prijave po radionici</h3>
      <div class="counter-list" id="counterList"></div>
    </div>

    <!-- Tablica prijava -->
    <table id="dataTable" style="display:none;">
      <thead>
        <tr>
          <th>Email</th>
          <th>Radionica</th>
          <th>Vrijeme</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
    import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

    // üîë Tvoj Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB_xmoQZ3JCEtku1PUphlJYa6kshwSjSdo",
    authDomain: "radionice-dff45.firebaseapp.com",
    projectId: "radionice-dff45",
    storageBucket: "radionice-dff45.firebasestorage.app",
    messagingSenderId: "1085580505175",
    appId: "1:1085580505175:web:697d9e635eb669b07a7312",
    measurementId: "G-ME77NDV08L"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginForm = document.getElementById("loginForm");
    const dataSection = document.getElementById("dataSection");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const status = document.getElementById("status");
    const table = document.getElementById("dataTable");
    const tbody = document.getElementById("tableBody");
    const loginStatus = document.getElementById("loginStatus");
    const countersDiv = document.getElementById("counters");
    const counterList = document.getElementById("counterList");

    // Login
    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginStatus.textContent = "‚úÖ Uspje≈°na prijava!";
      } catch (err) {
        loginStatus.textContent = "‚ùå Gre≈°ka: " + err.message;
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // State change
    onAuthStateChanged(auth, user => {
      if (user) {
        loginForm.style.display = "none";
        dataSection.style.display = "block";
        loadData();
      } else {
        loginForm.style.display = "block";
        dataSection.style.display = "none";
      }
    });

    // Uƒçitavanje podataka + brojaƒç
    async function loadData() {
      try {
        const q = query(collection(db, "interesi"), orderBy("timestamp", "desc"));
        const snapshot = await getDocs(q);

        tbody.innerHTML = "";
        const counts = {}; // brojaƒç po radionici

        snapshot.forEach(doc => {
          const data = doc.data();
          const tr = document.createElement("tr");

          const tdEmail = document.createElement("td");
          tdEmail.textContent = data.email;

          const tdWorkshop = document.createElement("td");
          tdWorkshop.textContent = data.workshop;

          const tdTime = document.createElement("td");
          tdTime.textContent = data.timestamp.toDate().toLocaleString("hr-HR");

          tr.appendChild(tdEmail);
          tr.appendChild(tdWorkshop);
          tr.appendChild(tdTime);
          tbody.appendChild(tr);

          // brojaƒç
          counts[data.workshop] = (counts[data.workshop] || 0) + 1;
        });

        // Prika≈æi brojaƒçe
        counterList.innerHTML = "";
        for (const [workshop, count] of Object.entries(counts)) {
          const div = document.createElement("div");
          div.className = "counter-item";
          div.textContent = `${workshop}: ${count}`;
          counterList.appendChild(div);
        }

        countersDiv.style.display = "block";
        status.style.display = "none";
        table.style.display = "table";
      } catch (err) {
        console.error("Gre≈°ka:", err);
        status.textContent = "‚ùå Ne mogu dohvatiti podatke.";
      }
    }
  </script>
</body>
</html>
